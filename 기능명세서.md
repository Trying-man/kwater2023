# 뉴스 수집 및 감정 분석 시스템 기능명세서

## 1. 시스템 개요

### 1.1 시스템 목적
- 네이버 News API를 활용한 뉴스 기사 자동 수집
- 한국어 자연어 처리를 통한 감정 분석 (Positive/Neutral/Negative)
- RESTful API를 통한 데이터 조회 및 관리
- 특정 키워드("kwater", "한국수자원공사") 기반 필터링

### 1.2 시스템 아키텍처
- **Backend**: FastAPI (Python)
- **Database**: PostgreSQL
- **AI Model**: KoBERT (KLUE/bert-base)
- **External API**: 네이버 News API
- **Deployment**: Uvicorn ASGI Server

## 2. 핵심 기능

### 2.1 뉴스 수집 기능 (NewsCollector)

#### 2.1.1 기능 설명
- 네이버 News API를 통한 실시간 뉴스 수집
- 비동기 HTTP 요청 처리 (aiohttp)
- 페이지네이션을 통한 대용량 데이터 수집
- 키워드 기반 필터링

#### 2.1.2 주요 메서드
```python
async def fetch_news(query: str, max_results: int) -> List[Dict]
```
- **입력**: 검색 쿼리, 최대 결과 수
- **출력**: 필터링된 뉴스 기사 목록
- **기능**: 
  - 네이버 API 호출
  - 키워드 필터링 ("kwater", "한국수자원공사")
  - HTML 태그 제거
  - 날짜 파싱

#### 2.1.3 데이터 구조
```json
{
  "title": "기사 제목",
  "content": "기사 내용",
  "url": "기사 URL",
  "published_at": "발행일시"
}
```

### 2.2 감정 분석 기능 (SentimentAnalyzer)

#### 2.2.1 기능 설명
- 한국어 특화 감정 분석 모델 (KLUE/bert-base)
- 3분류 감정 분석 (Positive/Neutral/Negative)
- 임계값 기반 분류 정확도 향상
- 배치 처리 지원

#### 2.2.2 주요 메서드
```python
def analyze(text: str) -> str
def analyze_batch(texts: List[str]) -> List[str]
```

#### 2.2.3 감정 분류 기준
- **Positive**: 긍정적 감정 (임계값: 0.6)
- **Neutral**: 중립적 감정 (기본값)
- **Negative**: 부정적 감정 (임계값: 0.6)

### 2.3 데이터베이스 관리

#### 2.3.1 데이터 모델
```sql
CREATE TABLE articles (
    id SERIAL PRIMARY KEY,
    title TEXT NOT NULL,
    content TEXT NOT NULL,
    url VARCHAR UNIQUE NOT NULL,
    published_at TIMESTAMP NOT NULL,
    sentiment VARCHAR(10),
    created_at TIMESTAMP DEFAULT NOW()
);
```

#### 2.3.2 주요 기능
- 기사 중복 방지 (URL 기반)
- 감정 분석 결과 저장
- 생성일시 자동 기록

## 3. API 엔드포인트

### 3.1 뉴스 조회 API

#### 3.1.1 전체 뉴스 조회
```
GET /news
```
- **쿼리 파라미터**:
  - `query`: 검색 키워드 (기본값: "kwater OR 한국수자원공사")
  - `max_results`: 최대 결과 수 (기본값: 100)

#### 3.1.2 K-water 전용 뉴스 조회
```
GET /news/kwater
```
- **쿼리 파라미터**:
  - `max_results`: 최대 결과 수 (기본값: 50)

### 3.2 감정 분석 API

#### 3.2.1 감정 분석 포함 뉴스 조회
```
GET /news/with-sentiment
GET /news/kwater/with-sentiment
```

#### 3.2.2 단일 텍스트 감정 분석
```
POST /sentiment/analyze
```
- **요청 본문**: `{"text": "분석할 텍스트"}`
- **응답**: `{"sentiment": "Positive/Neutral/Negative"}`

#### 3.2.3 배치 감정 분석
```
POST /sentiment/analyze-batch
```
- **요청 본문**: `{"texts": ["텍스트1", "텍스트2", ...]}`
- **응답**: `{"sentiments": ["Positive", "Neutral", ...]}`

#### 3.2.4 감정 분석 상태 확인
```
GET /sentiment/status
```

### 3.3 데이터베이스 API

#### 3.3.1 저장된 기사 조회
```
GET /api/articles
```
- **쿼리 파라미터**:
  - `sentiment`: 감정 분류 필터
  - `page`: 페이지 번호
  - `size`: 페이지당 항목 수

#### 3.3.2 특정 기사 조회
```
GET /api/articles/{id}
```

#### 3.3.3 뉴스 수집 트리거
```
POST /api/trigger-fetch
```

#### 3.3.4 감정 분석 트리거
```
POST /api/trigger-sentiment
```

## 4. 시스템 요구사항

### 4.1 기술 요구사항
- **Python**: 3.8 이상
- **메모리**: 최소 4GB (감정분석 모델 로딩용)
- **저장공간**: 최소 2GB
- **네트워크**: 인터넷 연결 필수

### 4.2 의존성 패키지
```
fastapi==0.104.1
uvicorn[standard]==0.24.0
aiohttp==3.9.1
python-dotenv==1.0.0
transformers==4.35.2
torch==2.1.1
numpy==1.26.2
sqlalchemy
psycopg2-binary
```

### 4.3 환경 변수
```env
NAVER_CLIENT_ID=your_client_id
NAVER_CLIENT_SECRET=your_client_secret
DATABASE_URL=postgresql://user:password@localhost:5432/dbname
```

## 5. 성능 및 제한사항

### 5.1 성능 지표
- **뉴스 수집**: 최대 100건/요청
- **감정 분석**: 약 1-2초/텍스트
- **API 응답**: 평균 200ms 이내
- **동시 요청**: 최대 100개

### 5.2 제한사항
- 네이버 API 호출 제한 (일일 25,000회)
- 감정분석 모델 메모리 사용량 (약 1GB)
- 텍스트 길이 제한 (최대 512 토큰)

## 6. 보안 및 에러 처리

### 6.1 보안
- CORS 설정 (개발환경: 모든 도메인 허용)
- API 키 환경변수 관리
- SQL Injection 방지 (SQLAlchemy ORM)

### 6.2 에러 처리
- HTTP 상태 코드 기반 에러 응답
- 감정분석 모델 로딩 실패 시 기능 비활성화
- 네트워크 오류 시 재시도 로직

## 7. 모니터링 및 로깅

### 7.1 로깅
- 감정분석 과정 상세 로깅
- API 요청/응답 로깅
- 에러 상황 로깅

### 7.2 모니터링
- 감정분석 모델 상태 확인
- API 응답 시간 모니터링
- 데이터베이스 연결 상태 확인

## 8. 배포 및 운영

### 8.1 개발 환경 실행
```bash
pip install -r requirements.txt
python main.py
```

### 8.2 API 문서
- Swagger UI: `http://localhost:8000/docs`
- ReDoc: `http://localhost:8000/redoc`

### 8.3 헬스체크
```
GET /
```
- **응답**: `{"message": "News Collector API is running!"}`

## 9. 향후 개선 계획

### 9.1 기능 개선
- 실시간 알림 기능
- 감정 분석 정확도 향상
- 다국어 지원
- 대시보드 UI 개발

### 9.2 성능 개선
- 캐싱 시스템 도입
- 배치 처리 최적화
- 데이터베이스 인덱싱

### 9.3 확장성
- 마이크로서비스 아키텍처
- 컨테이너화 (Docker)
- 클라우드 배포 지원 